<div style="display:none;" class="author">
{
    "subtitle": "2025CCSP题解",
    "title" : "算法",
    "date" : "2025",
    "description": "哈尔滨之旅",
    "tag" : ["技术","算法"]
}
</div>


## 题目

给定长度为 n 的数组 A，元素均为小于 2^30 的正整数。满足当 i < j 时 (a_i XOR x) < (a_j XOR x) ，则称之为完美元组。求x，使得数组中能构成完美元组的数量最大。易知能使得元组数量最大的x有多个，则输出最小的x，并输出该最大数量。

## 我在赛场上的思路
先计算x的有效位数k，比如 17（二进制为10001），有效位数就是5。
1. 暴力枚举x。
枚举x从 $0$ 到 $ 2^k-1 $，每次计算满足的元组数量，并记录最大值。
复杂度是 $ O(2^k n^2) $ 。
2. 贪心。
解法是：开始时假定x为 $ 2^k-1 $，按二进制从高到低考虑每个位。计算当前位不变（为1） 和当前位变为0这两种情况下，满足条件的元组数量。根据元组数量决定是否修改当前位（如果两种情况相等，优先选0，不同时选元组数量多的那种），然后继续下一位，直到确定全部位数。
我当时不知道这是贪心的解法，对于这个解法的原理也并不完全清楚，只是隐约觉得这样可能是对的。当时的想法是：要判断 $a _i,a _j$ 的大小，要从高位向低位依次判断，一旦高位确定，低位的变化都不会影响已经由高位决定的大小关系。也就是说，高位的影响大于低位，高位所决定的元组数量要大于低位。
我下了一个结论：无论x的所有的低位怎样变化，都不会影响高位的取值。比如，假设x的最高位为1时能产生的元组数量最多，那么无论x的所有的低位如何变化，最高位取1时能产生的元组数量永远比0多。
但是我当时也有一些担心：高位优先在排序时是铁律，但现在不是在排序，这个问题是全局化的，逐位局部最优能收敛到全局最优吗？
复杂度是$ O(k n^2) $，得分70，前70分正确，后30分超时。

3. 一些优化
当时看到题目是就想到应该用逆序对的解法，但是不知道怎么写，就放弃了。
队长使用逆序对只能拿到90分，复杂度为 $ O(k ~ n ~ log n) $ ，但是写的时候大概是 $ O( k ~ n ~ log^2 n) $ ，无论如何优化，都不能拿到100分，看来也是出题组的小巧思了。


## 正确的解法

我们可以把问题分解为两个操作：1. 通过贪心确定x的每一位取值 2. 计算满足条件的元组数量。

我们定义集合 $ C $ 含有所有的元组 $(a _i, a _j)$，默认满足 $i < j$。
为了方便表述，约定 $ x _l $ 表示x的第l位。

 
1. 贪心的思路：
对于x，可以由高到低依次考虑第k位，第k-1位，第k-2位，...，第1位，每位决定为1或0，使得完美元组数量最大化。
为什么可以这样做？
对于最高位第k位来说，如果 $a _i, a _j$ 的第k位不同，那么就可以确定两个数的大小关系，如果第k位相同，那么就不能确定大小关系。此时，集合 $ C $ 被分为了两个子集合 “第k位能够确定大小关系“的元组和“第k位不能确定大小关系”的元组。
$ x _k $ 的取值只 “改变”（为1）或“不改变”（为0） “第k位能够确定大小关系”的元组，不能改变 “第k位不能确定大小关系”的元组。
“第k位能够确定大小关系”的元组，我们可以改变 $x _k$ 的取值，使得完美元组数量最大化。
“第k位不能确定大小关系”的元组需要通过更低的位来判断，然后递归判断。

然后，继续判断第k-1位，可以将“第k位不能确定大小关系”的元组继续分为“第k-1位能够确定大小关系”的元组和“第k-1位不能确定大小关系”的元组，然后跟上述步骤一样，确定 $x _{k-1}$ 的取值。
依次递归考虑k-2,k-3 ... ，直到考虑完所有位，就得到了x。

在以上做法中，我们不停地确定“第k位能够确定大小关系”的元组的最优解，然后将“第k位不能确定大小关系”的元组分割为“第k-1位能够确定大小关系”的元组和“第k-1位不能确定大小关系”的元组，直到确定所有位。这就是通过局部最优解得到全局最优解的贪心方法。


2. 计算满足条件的元组数量
上面方法解释了贪心的原理，但计算完美元组数量的空间复杂度和时间复杂度都为 $ O(n^2) $ ，我们需要继续优化。
继续来看数组A，对于最高位第k位而言，要判断 $a _i, a _j$ 的大小关系，我们需要考虑数组A中的元素的第k位，而不需要考虑数组A中其他位。我们可以将数组A中的元素按照顺序提取第k位，形成一个新的数组 $ B _k $。
“能够确定大小关系”的元组是：对于第 i 个数，当 $ b _i = 0 / 1  $ 时，在 i 后的数组 $ 1 / 0 $  的数量就是能够与第 i 个数组成的“能够确定大小关系”的元组的数量，对数组中所有数进行累加就可以得到“能够确定大小关系”的元组数量。这里可以使用后缀和快速计算，时间复杂度为 $ O(n) $ 。

对于“不能确定大小关系”的元组，应当将原数组A先分为当 $ b _i = 0 $ 时的元组和当 $ b _i = 1 $ 时的元组，才能进一步向第 k-1 位判断。这样就是相当于是一个二叉树的结构。
这样就是一个 k层，最大节点数量为 n 的二叉树。
理论时间复杂度为 $ O(n log n) $

## 代码
不会写...