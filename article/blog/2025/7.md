<div style="display:none;" class="author">
{
    "title": "书籍pdf阅读优化方案",
    "date" : "2025-07-13",
    "weather" : "sunny",
    "description": "书籍pdf阅读优化方案",
    "tag" : ["生活","感想"]
}
</div>


## 大致思路
书籍pdf转成图片，导入扫描全能王优化清晰度。AI生成目录xml，使用WPS添加书签（会自动把书签识别为目录）。阅读时开启屏幕反色，就变成黑底白字了。

## 解决方案
### 高清优化
1. 下载书籍的pdf版本，推荐在zlib上搜索资源
2. 将pdf转为图片（自行调整dpi）
![](https://sns-na-i4.xhscdn.com/spectrum/1040g34o31ju5g31ak8105pgi0nb1om97ob1tcvo)

3. 桌面版上传图片，等待同步
![](https://sns-na-i2.xhscdn.com/spectrum/1040g34o31jrhb0un48105pgi0nb1om97ie1e3mg)

4. 等上传完成，手机端进行高清修复
![](https://sns-na-i1.xhscdn.com/spectrum/1040g0k031jv82040jq005pgi0nb1om97h630f4o)

5. 在网页端，下载pdf文件
![](https://sns-na-i2.xhscdn.com/spectrum/1040g0k031jslfvla36005pgi0nb1om97sa0am88)

注意：
反色后文字边缘噪点比较明显，看起来像是光晕一样，但并不明显。解决这个问题需要再次转图片，进行非局部均值去噪，很耗时间，就不弄了。
如果有水印，可自行添加裁剪功能。


### 目录生成

1. 上传目录截图，AI自动生成xml格式书签，推荐使用Kimi
![](https://sns-na-i4.xhscdn.com/spectrum/1040g34o31kjked9q3q105pgi0nb1om97stg5dlo)

2. 对xml进行处理，添加参数（固定参数，如果让AI生成速度太慢），更新页码（因为目录的页码和PDF的页码不一致）
![](https://sns-na-i4.xhscdn.com/spectrum/1040g0k031kjkfmol2g005pgi0nb1om97ekri8ag)


3. 导入
![](https://sns-na-i4.xhscdn.com/spectrum/1040g0k031kjlkssjj6005pgi0nb1om97i7g8ju8)




### 反色

1. 平板开启反色，效果图
![](https://sns-na-i4.xhscdn.com/1040g2sg31jv7svk9j6kg5pgi0nb1om97839so4o)

## 视频教程

<video src="http://sns-video-default.xhscdn.com/spectrum/1040g35831kjmvhk0ig105pgi0nb1om97bbou9i8" controls="controls" preload="metadata" video-id="0" ></video>

## 附件

### 书签更新
```python
import xml.etree.ElementTree as ET

def update_items(input_file,output_file,x):
        tree = ET.parse(input_file)
        root = tree.getroot()

        attributes = {
            "PAGE" : "1",
            "OPEN": "1",
            "FONTSTYLE": "0",
            "COLOR": "4278190080",
            "ZOOMMODE": "0",
            "PARMA": "0,0,0,0"
        }

        # 查找所有的ITEM元素并添加属性
        item_count = 0
        for item in root.iter("ITEM"):
            # 为每个ITEM添加属性，如果属性已存在会被覆盖
            for key, value in attributes.items():
                if key == "PAGE":
                    try:
                        value = str(int(item.get("PAGE")) + x)
                    except:
                        print(item.get("NAME"))
                item.set(key, value)
            item_count += 1

        tree.write(output_file, encoding="utf-8", xml_declaration=True)
        print(f"成功处理 {item_count} 个ITEM元素")
        print(f"处理后的文件已保存至: {output_file}")

if __name__ == "__main__":
    input_xml = "book/input.xml"
    output_file = r"output.xml"
    # x是偏移量，因为目录的页码和PDF的页码不一致
    x = 16

    update_items(input_xml,output_file,x)
```


### pdf2img
```python
import os
import time
from concurrent.futures import ProcessPoolExecutor

import fitz  # PyMuPDF
from functools import lru_cache
from PIL import Image

@lru_cache(maxsize=1)
def get_doc(pdf_path):
    return fitz.open(pdf_path)

def process_page(args):
    pdf_path, page_num, output_folder, dpi = args
    """处理单个页面并保存为图像"""
    doc = get_doc(pdf_path)
    page = doc.load_page(page_num)
    pix = page.get_pixmap(dpi=dpi)
    output_file = os.path.join(output_folder, f"{page_num + 1 :04d}.jpeg")

    img = Image.frombytes("RGB", (pix.width, pix.height), pix.samples)
    img.save(output_file, "jpeg")
    return "1"

def pdf2images(pdf_path, output_folder, dpi, workers):
    """使用多进程并行转换PDF页面为图像"""
    start_time = time.time()
    os.makedirs(output_folder, exist_ok=True)

    total_pages = len(fitz.open(pdf_path))

    tasks = [(pdf_path,page_num, output_folder, dpi) for page_num in range(total_pages)]

    with ProcessPoolExecutor(max_workers=workers) as executor:
        futures = [executor.submit(process_page, task) for task in tasks]
        for i, future in enumerate(futures):
            result = future.result()
            if result:
                print(f"Processed page {i + 1}/{total_pages}: {os.path.basename(result)}")

    print(f"Conversion completed in {time.time() - start_time:.2f} seconds")




if __name__ == "__main__":
    # 配置参数
    pdf_path = r"book/自己动手写cpu-雷思磊.pdf"
    output_dir = r"book/o"
    dpi = 300  # 根据实际需要调整
    workers = 20

    pdf2images(pdf_path, output_dir, dpi, workers)


```

### AI提示词

```prompt
技能:处理目录图片生成XML代码
1.接收用户提供的目录信息。
2.依据以下指定结构生成XML书签：
    -通过ITEM的嵌套和INDENT属性构建清晰的多级书签结构。
    -PAGE值需对应目录项在文档中的准确页码
    -NAME为准确的目录文本。
3.严格按照xml格式输出，不得出现其他无关内容。
===回复示例===

<?xml version="1.0" encoding="UTF-8"?>
<BOOKMARKS>
    <INFO PRODUCER="WPS PDF"/>
    <ITEM INDENT="1"  PAGE="18" NAME="1">
        <ITEM INDENT="2" PAGE="18" NAME="1.1">
            <ITEM INDENT="3" PAGE="18" NAME="1.1.1">
                <ITEM INDENT="4"  PAGE="18" NAME="1.1.1.1"/>
                <ITEM INDENT="4"  PAGE="18" NAME="1.1.1.2"/>
            </ITEM>
        </ITEM>
    </ITEM>
    <ITEM INDENT="1" PAGE="18" NAME="2">
        <ITEM INDENT="2" PAGE="18" NAME="2.1"/>
        <ITEM INDENT="2"  PAGE="18" NAME="2.2"/>
    </ITEM>
</BOOKMARKS>
===示例结束===
限制:
-输出必须严格遵循xml格式规范。
-仅围绕生成符合要求的XML书签相关内容进行回复，不回答其他无关问题。

```